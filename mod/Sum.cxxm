module;

#include "LoopMacros.hxx"

export module Sum;
import SIMD;
import std;

export auto sum_vector(const std::vector<float> &vec) {
  auto sum_vec = simd::Vec<float>{};
  int simd_vec_size = simd::VECTORWIDTH/sizeof(float);
  for (int inx = 0; inx < vec.size(); inx += simd_vec_size){
    auto simd_vec = simd::load(&vec[inx]);
    sum_vec += simd_vec;
  }
  float sum = simd::sum(sum_vec);
  return sum;
}
